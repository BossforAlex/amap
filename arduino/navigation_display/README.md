# ESP32导航显示程序

这是ESP32的Arduino程序，用于接收通过蓝牙发送的导航数据并在TFT屏幕上显示。

## 功能特点

- 使用BLE（低功耗蓝牙）接收数据
- 在TFT屏幕上显示导航信息
- 实时更新导航状态
- 显示连接状态

## 硬件要求

- ESP32开发板
- TFT显示屏（支持TFT_eSPI库）
- 连接线若干

## 引脚连接

默认使用以下引脚连接（可根据实际修改）：

| TFT引脚 | ESP32引脚 | 说明 |
|---------|-----------|------|
| VCC     | 3.3V      | 电源 |
| GND     | GND       | 地线 |
| SCL     | 18        | SPI时钟 |
| SDA     | 23        | SPI数据 |
| RES     | 4         | 复位 |
| DC      | 2         | 数据/命令选择 |
| CS      | 15        | 片选 |
| BL      | 5         | 背光控制 |

## 安装步骤

1. 安装Arduino IDE（1.8.x或2.x版本）

2. 在Arduino IDE中添加ESP32开发板支持：
   - 打开 文件 > 首选项
   - 在"附加开发板管理器网址"中添加：
     ```
     https://raw.githubusercontent.com/espressif/arduino-esp32/gh-pages/package_esp32_index.json
     ```
   - 打开 工具 > 开发板 > 开发板管理器
   - 搜索并安装"esp32"

3. 安装所需库：
   - 打开 工具 > 管理库
   - 搜索并安装：
     - "TFT_eSPI" by Bodmer
     - "ESP32 BLE Arduino" by Neil Kolban

4. 配置TFT_eSPI库：
   - 打开 文件 > 首选项，找到"项目文件夹位置"
   - 进入`Arduino/libraries/TFT_eSPI`
   - 编辑`User_Setup.h`文件，根据您的屏幕型号进行配置
   - 或者使用`User_Setup_Select.h`选择合适的配置

5. 上传程序：
   - 选择正确的开发板和端口
   - 点击上传按钮

## 蓝牙配置

- 设备名称：ESP32_Navigation_Display
- 服务UUID：4fafc201-1fb5-459e-8fcc-c5c9c331914b
- 特征值UUID：beb5483e-36e1-4688-b7f5-ea07361b26a8

## 数据格式

接收的导航数据为JSON格式，包含以下字段：

```json
{
  "roadName": "当前道路名称",
  "action": "下一步动作",
  "distance": 500,        // 距离（米）
  "remainingTime": 300,   // 剩余时间（秒）
  "speed": 60,           // 当前速度（km/h）
  "isActive": true       // 是否正在导航
}
```

## 显示内容

屏幕显示以下信息：
- 标题：导航信息
- 当前道路：显示当前所在道路名称
- 下一步：显示下一步导航动作
- 距离：显示到下一个动作的距离
- 剩余时间：显示预计剩余时间
- 当前速度：显示当前行驶速度
- 连接状态：显示蓝牙连接状态（绿色=已连接，红色=未连接）

## 自定义修改

### 修改显示颜色
在`updateDisplay()`函数中可以修改颜色：
```cpp
tft.setTextColor(TFT_YELLOW, TFT_BLACK);  // 设置文本颜色
```

### 修改字体大小
```cpp
tft.setTextSize(2);  // 设置字体大小
```

### 修改刷新频率
在`loop()`函数中修改延迟时间：
```cpp
delay(100);  // 修改刷新间隔
```

## 故障排除

### 屏幕不显示
- 检查接线是否正确
- 确认TFT_eSPI库配置正确
- 检查背光是否开启

### 蓝牙无法连接
- 确认ESP32蓝牙已初始化
- 检查Android设备蓝牙是否开启
- 确认UUID配置正确

### 数据显示异常
- 检查JSON格式是否正确
- 确认数据解析逻辑
- 查看串口输出调试信息

## 串口调试

程序启动后，可以通过串口监视器查看调试信息：
- 波特率：115200
- 输出信息包括：启动信息、连接状态、接收的数据等

## 扩展功能

您可以根据需要添加以下功能：
- 保存导航历史记录
- 添加语音提示
- 支持多种显示模式
- 添加传感器数据（如温度、湿度）